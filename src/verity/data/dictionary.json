{
  "version": "1.3",
  "updated_at": "2025-12-26T20:00:00Z",
  "description": "Data Dictionary para Verity - Definiciones canónicas de tablas y métricas",
  "tables": {
    "orders": {
      "description": "Órdenes realizadas en la plataforma",
      "grain": "1 row = 1 order",
      "primary_key": "order_id",
      "time_column": "order_date",
      "columns": {
        "order_id": {
          "type": "string",
          "description": "Identificador único de la orden"
        },
        "customer_id": {
          "type": "string",
          "description": "Identificador del cliente que realizó la orden"
        },
        "order_status": {
          "type": "string",
          "description": "Estado de la orden: pending | delivered | cancelled"
        },
        "order_date": {
          "type": "date",
          "description": "Fecha en que se realizó la orden"
        },
        "order_amount": {
          "type": "number",
          "description": "Monto total de la orden en moneda local"
        }
      }
    },
    "listening_history": {
      "description": "Historial de reproducción de música de Spotify",
      "grain": "1 row = 1 play event",
      "primary_key": "play_id",
      "time_column": "played_at",
      "columns": {
        "play_id": {
          "type": "string",
          "description": "Identificador único de la reproducción"
        },
        "track_name": {
          "type": "string",
          "description": "Nombre de la canción reproducida"
        },
        "artist_name": {
          "type": "string",
          "description": "Nombre del artista"
        },
        "played_at": {
          "type": "timestamp",
          "description": "Timestamp de finalización de reproducción"
        },
        "ms_played": {
          "type": "integer",
          "description": "Duración de reproducción en milisegundos"
        }
      }
    }
  },
  "metrics": {
    "total_orders": {
      "description": "Total de órdenes",
      "table": "orders",
      "expression": "COUNT(order_id)",
      "data_type": "integer",
      "requires": [
        "order_id"
      ],
      "filters": [],
      "aliases": [
        "orders",
        "ordenes",
        "órdenes",
        "pedidos",
        "total pedidos"
      ],
      "format": "number"
    },
    "total_revenue": {
      "description": "Ingresos totales",
      "table": "orders",
      "expression": "SUM(order_amount)",
      "data_type": "number",
      "requires": [
        "order_amount"
      ],
      "filters": [],
      "aliases": [
        "revenue",
        "ingresos",
        "ventas",
        "sales",
        "total ventas",
        "dinero"
      ],
      "format": "currency"
    },
    "delivered_orders": {
      "description": "Órdenes entregadas",
      "table": "orders",
      "expression": "COUNT(order_id)",
      "data_type": "integer",
      "requires": [
        "order_id",
        "order_status"
      ],
      "filters": [
        {
          "column": "order_status",
          "operator": "=",
          "value": "delivered"
        }
      ],
      "aliases": [
        "delivered",
        "entregadas",
        "entregas"
      ],
      "format": "number"
    },
    "delivered_revenue": {
      "description": "Ingresos de órdenes entregadas",
      "table": "orders",
      "expression": "SUM(order_amount)",
      "data_type": "number",
      "requires": [
        "order_amount",
        "order_status"
      ],
      "filters": [
        {
          "column": "order_status",
          "operator": "=",
          "value": "delivered"
        }
      ],
      "aliases": [
        "delivered revenue",
        "ingresos entregados"
      ],
      "format": "currency"
    },
    "total_plays": {
      "description": "Total de reproducciones de música",
      "table": "listening_history",
      "expression": "COUNT(play_id)",
      "data_type": "integer",
      "requires": [
        "play_id"
      ],
      "filters": [],
      "aliases": [
        "plays",
        "reproducciones",
        "total reproducciones",
        "cuantas canciones",
        "cuántas canciones",
        "numero de canciones",
        "número de canciones",
        "canciones escuchadas",
        "songs played",
        "total songs"
      ],
      "format": "number"
    },
    "unique_tracks": {
      "description": "Canciones únicas escuchadas",
      "table": "listening_history",
      "expression": "COUNT(DISTINCT track_name)",
      "data_type": "integer",
      "requires": [
        "track_name"
      ],
      "filters": [],
      "aliases": [
        "unique songs",
        "canciones unicas",
        "canciones únicas",
        "diferentes canciones",
        "tracks",
        "distinct tracks"
      ],
      "format": "number"
    },
    "unique_artists": {
      "description": "Artistas únicos escuchados",
      "table": "listening_history",
      "expression": "COUNT(DISTINCT artist_name)",
      "data_type": "integer",
      "requires": [
        "artist_name"
      ],
      "filters": [],
      "aliases": [
        "unique artists",
        "artistas unicos",
        "artistas únicos",
        "diferentes artistas",
        "cuantos artistas",
        "cuántos artistas"
      ],
      "format": "number"
    },
    "total_listening_time": {
      "description": "Tiempo total de escucha en horas",
      "table": "listening_history",
      "expression": "SUM(ms_played) / 3600000.0",
      "data_type": "number",
      "requires": [
        "ms_played"
      ],
      "filters": [],
      "aliases": [
        "listening time",
        "tiempo de escucha",
        "horas de musica",
        "horas de música",
        "tiempo total",
        "total time",
        "cuanto tiempo",
        "cuánto tiempo"
      ],
      "format": "number",
      "business_notes": "Convertido a horas (ms / 3600000)"
    },
    "avg_track_duration": {
      "description": "Duración promedio de canciones en minutos",
      "table": "listening_history",
      "expression": "AVG(ms_played) / 60000.0",
      "data_type": "number",
      "requires": [
        "ms_played"
      ],
      "filters": [],
      "aliases": [
        "average duration",
        "duracion promedio",
        "duración promedio",
        "promedio de duracion",
        "promedio de duración",
        "avg duration"
      ],
      "format": "number",
      "business_notes": "Convertido a minutos (ms / 60000)"
    },
    "top_artist": {
      "description": "Artista más escuchado por tiempo total",
      "table": "listening_history",
      "expression": "MODE() WITHIN GROUP (ORDER BY artist_name)",
      "data_type": "string",
      "requires": [
        "artist_name",
        "ms_played"
      ],
      "filters": [],
      "aliases": [
        "most played artist",
        "artista mas escuchado",
        "artista más escuchado",
        "top artist",
        "artista favorito",
        "favorite artist"
      ],
      "format": "string",
      "business_notes": "Requiere agregación especial por tiempo total"
    }
  },
  "changelog": [
    {
      "version": "1.0",
      "date": "2025-12-20",
      "change": "Initial data dictionary with orders table and 4 canonical metrics"
    },
    {
      "version": "1.1",
      "date": "2025-12-25",
      "change": "Expanded metrics map: added order-status metrics and richer aliases; kept metric-level filters deterministic"
    },
    {
      "version": "1.2",
      "date": "2025-12-25",
      "change": "Added listening_history table with 6 music metrics for Spotify data beta testing"
    },
    {
      "version": "1.3",
      "date": "2025-12-26",
      "change": "Restored orders metrics (total_orders, total_revenue, delivered_orders, delivered_revenue) for multi-domain support"
    }
  ]
}